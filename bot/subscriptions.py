# bot/subscriptions.py

from __future__ import annotations

from typing import Dict, Optional

from aiogram.types import ReplyKeyboardMarkup, KeyboardButton

# ---- –†–ï–ñ–ò–ú–´ –†–ê–ë–û–¢–´ –ë–û–¢–ê ----

# –ö–ª—é—á —Ä–µ–∂–∏–º–∞ -> –∫–æ–Ω—Ñ–∏–≥
MODES: Dict[str, Dict[str, str]] = {
    "growth": {
        "button": "üéØ –°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ",
        "title": "–°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ –∏ —Ü–µ–ª–∏",
        "prompt": (
            "–¢—ã –≤—ã—Å—Ç—É–ø–∞–µ—à—å –≤ —Ä–æ–ª–∏ –ª–∏—á–Ω–æ–≥–æ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞ –ø–æ —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—é.\n"
            "–ü–æ–º–æ–≥–∞–π —Å—Ç–∞–≤–∏—Ç—å —Ü–µ–ª–∏, –Ω–∞—Ö–æ–¥–∏—Ç—å —Ñ–æ–∫—É—Å, –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏, "
            "–¥–∞–≤–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã –¥–µ–π—Å—Ç–≤–∏–π –∏ —á–µ—Å—Ç–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å."
        ),
    },
    "business": {
        "button": "üìà –ë–∏–∑–Ω–µ—Å –∏ –¥–µ–Ω—å–≥–∏",
        "title": "–ë–∏–∑–Ω–µ—Å, –¥–µ–Ω—å–≥–∏ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è",
        "prompt": (
            "–¢—ã –º–µ–Ω—Ç–æ—Ä –ø–æ –±–∏–∑–Ω–µ—Å—É –∏ –¥–µ–Ω—å–≥–∞–º.\n"
            "–ü–æ–º–æ–≥–∞–π —Å –∏–¥–µ—è–º–∏, —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π, –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–µ–π, –∞–Ω–∞–ª–∏–∑–æ–º —Ä–∏—Å–∫–æ–≤ –∏ —à–∞–≥–∞–º–∏ –∫ —Ä–æ—Å—Ç—É –¥–æ—Ö–æ–¥–∞."
        ),
    },
    "health": {
        "button": "üë®‚Äç‚öïÔ∏è –ó–¥–æ—Ä–æ–≤—å–µ –∏ –º–µ–¥–∏—Ü–∏–Ω–∞",
        "title": "–ó–¥–æ—Ä–æ–≤—å–µ –∏ –º–µ–¥–∏—Ü–∏–Ω–∞",
        "prompt": (
            "–¢—ã –ø–æ–º–æ–≥–∞–µ—à—å —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ –≤–æ–ø—Ä–æ—Å–∞—Ö –∑–¥–æ—Ä–æ–≤—å—è.\n"
            "–û–±—ä—è—Å–Ω—è–π –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ, –≤—Å–µ–≥–¥–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–π, —á—Ç–æ —Ç—ã –Ω–µ –∑–∞–º–µ–Ω—è–µ—à—å –≤—Ä–∞—á–∞, "
            "–∏ –ø—Ä–∏ —Å–µ—Ä—å—ë–∑–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–∞—Ö —Å–æ–≤–µ—Ç—É–π –æ—á–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é."
        ),
    },
    "chat": {
        "button": "üí¨ –ü—Ä–æ—Å—Ç–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å",
        "title": "–û–±—â–∏–π –¥–∏–∞–ª–æ–≥",
        "prompt": (
            "–¢—ã –≤–µ–¥—ë—à—å –∂–∏–≤–æ–π, —Ç—ë–ø–ª—ã–π –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥.\n"
            "–ú–æ–∂–Ω–æ –æ–±—Å—É–∂–¥–∞—Ç—å –ª–∏—á–Ω—ã–µ —Ç–µ–º—ã, –∏–¥–µ–∏, —ç–º–æ—Ü–∏–∏, –ø–ª–∞–Ω—ã –∏ –≤–æ–ø—Ä–æ—Å—ã –±–µ–∑ –∂—ë—Å—Ç–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã."
        ),
    },
}

DEFAULT_MODE_KEY: Optional[str] = None  # None = –æ–±—â–∏–π —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é


def get_mode_key_from_button(text: str) -> Optional[str]:
    text = (text or "").strip()
    for key, cfg in MODES.items():
        if cfg["button"] == text:
            return key
    return None


def get_mode_title(mode_key: Optional[str]) -> str:
    if not mode_key or mode_key not in MODES:
        return "–û–±—â–∏–π —Ä–µ–∂–∏–º"
    return MODES[mode_key]["title"]


def get_mode_prompt(mode_key: Optional[str]) -> str:
    if not mode_key or mode_key not in MODES:
        # –ë–∞–∑–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
        return ""
    return MODES[mode_key]["prompt"]


MODE_BUTTON_TEXTS = {cfg["button"] for cfg in MODES.values()}

# ---- –ö–õ–ê–í–ò–ê–¢–£–†–´ ----

MAIN_MENU_KEYBOARD = ReplyKeyboardMarkup(
    keyboard=[
        [
            KeyboardButton(text="‚ú® –†–µ–∂–∏–º"),
            KeyboardButton(text="üíé –ü–æ–¥–ø–∏—Å–∫–∞"),
        ],
        [
            KeyboardButton(text="‚ùì –ü–æ–º–æ—â—å"),
            KeyboardButton(text="üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫"),
        ],
    ],
    resize_keyboard=True,
    input_field_placeholder="–°–ø—Ä–æ—Å–∏ –æ —á—ë–º —É–≥–æ–¥–Ω–æ‚Ä¶",
)

SUBSCRIPTION_KEYBOARD = ReplyKeyboardMarkup(
    keyboard=[
        [
            KeyboardButton(text="–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 30 –¥–Ω–µ–π ‚Äî TON"),
        ],
        [
            KeyboardButton(text="–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 30 –¥–Ω–µ–π ‚Äî USDT"),
        ],
        [
            KeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"),
        ],
    ],
    resize_keyboard=True,
)

MODE_SELECT_KEYBOARD = ReplyKeyboardMarkup(
    keyboard=[
        [
            KeyboardButton(text=MODES["growth"]["button"]),
            KeyboardButton(text=MODES["business"]["button"]),
        ],
        [
            KeyboardButton(text=MODES["health"]["button"]),
            KeyboardButton(text=MODES["chat"]["button"]),
        ],
        [
            KeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"),
        ],
    ],
    resize_keyboard=True,
    input_field_placeholder="–í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞",
)

# ---- –¢–ï–ö–°–¢–´ ----

START_TEXT = (
    "<b>–ü—Ä–∏–≤–µ—Ç, —è —Ç–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ò–ò-–∫–∞–±–∏–Ω–µ—Ç.</b>\n\n"
    "–ú–æ–∂–µ—à—å —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø—Ä–æ —Ä–∞–±–æ—Ç—É, –¥–µ–Ω—å–≥–∏, –∑–¥–æ—Ä–æ–≤—å–µ, –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –∏–¥–µ–∏, "
    "–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–Ω—è –∏ –≤—Å—ë, —á—Ç–æ —Å–µ–π—á–∞—Å –¥–µ—Ä–∂–∏—à—å –≤ –≥–æ–ª–æ–≤–µ.\n\n"
    "–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —è —Ä–∞–±–æ—Ç–∞—é –≤ –æ–±—â–µ–º —Ä–µ–∂–∏–º–µ.\n"
    "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è ‚Äî –Ω–∞–∂–º–∏ ¬´‚ú® –†–µ–∂–∏–º¬ª –∏ –≤—ã–±–µ—Ä–∏ —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã."
)

LIMIT_REACHED_TEXT = (
    "–¢—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –≤—Å–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.\n\n"
    "–ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –¥–ª–∏–Ω–µ –∏ –≥–ª—É–±–∏–Ω–µ –¥–∏–∞–ª–æ–≥–∞ ‚Äî "
    "–æ—Ñ–æ—Ä–º–∏ –ø—Ä–µ–º–∏—É–º-–¥–æ—Å—Ç—É–ø üíé –∑–∞ 5 TON –∏–ª–∏ 5 USDT –≤ –º–µ—Å—è—Ü.\n\n"
    "–ù–∞–∂–º–∏ ¬´üíé –ü–æ–¥–ø–∏—Å–∫–∞¬ª –≤–Ω–∏–∑—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —ç–∫—Ä–∞–Ω —Å –æ–ø–ª–∞—Ç–æ–π."
)

SUBSCRIPTION_INFO_TEXT = (
    "<b>üíé –ü—Ä–µ–º–∏—É–º-–¥–æ—Å—Ç—É–ø</b>\n\n"
    "–ß—Ç–æ –¥–∞—ë—Ç –ø–æ–¥–ø–∏—Å–∫–∞:\n"
    "‚Ä¢ –î–ª–∏–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –±–µ–∑ ¬´—Ä–µ–∂—å —Ç–µ–∫—Å—Ç¬ª\n"
    "‚Ä¢ –ì–ª—É–±–æ–∫–∏–µ —Ä–∞–∑–±–æ—Ä—ã –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤–º–µ—Å—Ç–æ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤\n"
    "‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–≤–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n\n"
    "–°—Ç–æ–∏–º–æ—Å—Ç—å: <b>5$ –≤ TON –∏–ª–∏ USDT –∑–∞ 30 –¥–Ω–µ–π</b> —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π @CryptoBot.\n\n"
    "–í—ã–±–µ—Ä–∏ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –Ω–∏–∂–µ ‚Äî TON –∏–ª–∏ USDT."
)

HELP_TEXT = (
    "<b>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç</b>\n\n"
    "‚Ä¢ –ü–∏—à–∏ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Ç–µ–∫—Å—Ç–æ–º ‚Äî –æ—Ç –ª–∏—á–Ω—ã—Ö –¥–æ —Ä–∞–±–æ—á–∏—Ö.\n"
    "‚Ä¢ –Ø –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –∑–∞–ø—Ä–æ—Å –∏ –¥–∞—é —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç.\n"
    "‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –¥–∞–ª—å—à–µ ‚Äî –ø—Ä–µ–º–∏—É–º.\n\n"
    "<b>–ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å:</b>\n"
    "1. –ù–∞–∂–º–∏ ¬´üíé –ü–æ–¥–ø–∏—Å–∫–∞¬ª.\n"
    "2. –í—ã–±–µ—Ä–∏ –æ–ø–ª–∞—Ç—É –≤ TON –∏–ª–∏ USDT.\n"
    "3. –Ø —Å–æ–∑–¥–∞–º —Å—á—ë—Ç —á–µ—Ä–µ–∑ @CryptoBot ‚Äî –æ—Ç–∫—Ä–æ–π –µ–≥–æ –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏ –æ–ø–ª–∞—Ç—É.\n\n"
    "<b>–ì–¥–µ –¥–µ–Ω—å–≥–∏:</b>\n"
    "–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ @CryptoBot –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∫—Ä–∏–ø—Ç–æ–∫–æ—à–µ–ª—ë–∫. "
    "–Ø –Ω–µ —Ö—Ä–∞–Ω—é –∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é —Ç–≤–æ–∏ –∫–∞—Ä—Ç—ã ‚Äî —Ç–æ–ª—å–∫–æ –∫—Ä–∏–ø—Ç–æ-–ø–ª–∞—Ç—ë–∂ –≤–Ω—É—Ç—Ä–∏ Telegram.\n\n"
    "<b>–ö–∞–∫ –æ—Ç–º–µ–Ω–∏—Ç—å:</b>\n"
    "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ß–µ—Ä–µ–∑ 30 –¥–Ω–µ–π –¥–µ–π—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è. "
    "–ï—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å ‚Äî –ø—Ä–æ—Å—Ç–æ –æ—Ñ–æ—Ä–º–ª—è–µ—à—å –¥–æ—Å—Ç—É–ø –∑–∞–Ω–æ–≤–æ."
)

ALL_BUTTON_TEXTS = {
    "‚ú® –†–µ–∂–∏–º",
    "üíé –ü–æ–¥–ø–∏—Å–∫–∞",
    "‚ùì –ü–æ–º–æ—â—å",
    "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫",
    "‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",
    "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 30 –¥–Ω–µ–π ‚Äî TON",
    "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 30 –¥–Ω–µ–π ‚Äî USDT",
    *MODE_BUTTON_TEXTS,
}
