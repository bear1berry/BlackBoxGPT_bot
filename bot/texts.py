from __future__ import annotations

from datetime import datetime
from typing import Optional


def _format_mode(mode: Optional[str]) -> str:
    mode = (mode or "universal").lower()
    mapping = {
        "universal": "üß† –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π",
        "medicine": "ü©∫ –ú–µ–¥–∏—Ü–∏–Ω–∞",
        "mentor": "üî• –ù–∞—Å—Ç–∞–≤–Ω–∏–∫",
        "business": "üíº –ë–∏–∑–Ω–µ—Å",
        "creative": "üé® –ö—Ä–µ–∞—Ç–∏–≤",
    }
    return mapping.get(mode, "üß† –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π")


def _format_subscription(
    tier: Optional[str],
    expires_at: Optional[datetime],
) -> str:
    tier = (tier or "free").lower()
    if tier == "premium":
        if expires_at:
            return (
                "üíé –°—Ç–∞—Ç—É—Å: <b>Premium</b>\n"
                f"‚è≥ –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: <b>{expires_at:%d.%m.%Y %H:%M}</b> (–ø–æ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏)"
            )
        return "üíé –°—Ç–∞—Ç—É—Å: <b>Premium</b>\n‚è≥ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: <b>–Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω</b>"
    return "üíº –°—Ç–∞—Ç—É—Å: <b>Free</b>\n‚ö†Ô∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ Premium."


# ---------- –û–ù–ë–û–†–î–ò–ù–ì ----------


def build_onboarding_text(name: Optional[str]) -> str:
    name = name or "–¥—Ä—É–≥"
    return (
        f"üëã –ü—Ä–∏–≤–µ—Ç, <b>{name}</b>!\n\n"
        "–¢—ã –≤ <b>BlackBox GPT</b> ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–º –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–µ —Å —Ä–µ–∂–∏–º–∞–º–∏ –ø–æ–¥ –ª—é–±—ã–µ –∑–∞–¥–∞—á–∏.\n\n"
        "üß† –ß—Ç–æ —è —É–º–µ—é:\n"
        "‚Ä¢ –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏ –æ–±—ä—è—Å–Ω—è—Ç—å —Å–ª–æ–∂–Ω–æ–µ –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º\n"
        "‚Ä¢ –ü–æ–º–æ–≥–∞—Ç—å —Å –º–µ–¥–∏—Ü–∏–Ω–æ–π (–∫–∞–∫ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∏ –ø–æ–º–æ—â–Ω–∏–∫, –Ω–æ –Ω–µ –≤–º–µ—Å—Ç–æ –≤—Ä–∞—á–∞)\n"
        "‚Ä¢ –ë—ã—Ç—å –ª–∏—á–Ω—ã–º –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–º –ø–æ –º—ã—à–ª–µ–Ω–∏—é, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ –∏ —Ä–∞–∑–≤–∏—Ç–∏—é\n"
        "‚Ä¢ –ü–æ–º–æ–≥–∞—Ç—å —Å –±–∏–∑–Ω–µ—Å-–∏–¥–µ—è–º–∏, —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –∏ —Ç–µ–∫—Å—Ç–∞–º–∏\n"
        "‚Ä¢ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–µ–∞—Ç–∏–≤, —Å—Ü–µ–Ω–∞—Ä–∏–∏, –∫–æ–Ω—Ü–µ–ø—Ç—ã –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–¥–µ–∏\n\n"
        "üëá –í–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ ‚Äî –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é. –í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å."
    )


# ---------- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù ----------


def build_main_menu_text(current_mode: Optional[str]) -> str:
    mode_text = _format_mode(current_mode)
    return (
        "üßä <b>BlackBox GPT ‚Äî Universal AI Assistant</b>\n\n"
        f"–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: {mode_text}\n\n"
        "üìå –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:\n"
        "‚Ä¢ –í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º –≤ –º–µ–Ω—é ¬´üß† –†–µ–∂–∏–º—ã¬ª\n"
        "‚Ä¢ –û—Ç–∫—Ä–æ–π ¬´üë§ –ü—Ä–æ—Ñ–∏–ª—å¬ª, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å –∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É\n"
        "‚Ä¢ –í ¬´üíé –ü–æ–¥–ø–∏—Å–∫–∞¬ª ‚Äî –Ω–∞—Å—Ç—Ä–æ–π Premium –∏ –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ Crypto Bot\n"
        "‚Ä¢ –í ¬´üë• –†–µ—Ñ–µ—Ä–∞–ª—ã¬ª ‚Äî –ø–æ–¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π –∏ –∑–∞–±–∏—Ä–∞–π –±–æ–Ω—É—Å–Ω—ã–µ –¥–Ω–∏ Premium\n\n"
        "–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π –∑–∞–ø—Ä–æ—Å, –∞ —è –ø–æ–¥–∞–º –æ—Ç–≤–µ—Ç –∫–∞–∫ –∞–∫–∫—É—Ä–∞—Ç–Ω—É—é –º–∏–Ω–∏-—Å—Ç–∞—Ç—å—é."
    )


def build_modes_text() -> str:
    return (
        "üß† <b>–†–µ–∂–∏–º—ã BlackBox GPT</b>\n\n"
        "–í—ã–±–µ—Ä–∏, –∫–∞–∫ —è –±—É–¥—É –º—ã—Å–ª–∏—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:\n\n"
        "üß† <b>–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π</b>\n"
        "‚Ä¢ –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –ª—é–±—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.\n\n"
        "ü©∫ <b>–ú–µ–¥–∏—Ü–∏–Ω–∞</b>\n"
        "‚Ä¢ –ë–æ–ª–µ–µ –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏, –æ–ø–æ—Ä–∞ –Ω–∞ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω—É—é –±–∞–∑—É.\n"
        "‚Ä¢ –ù–µ –∑–∞–º–µ–Ω—è–µ—Ç –≤—Ä–∞—á–∞, –∞ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è.\n\n"
        "üî• <b>–ù–∞—Å—Ç–∞–≤–Ω–∏–∫</b>\n"
        "‚Ä¢ –ì–ª—É–±–æ–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ, –∞–Ω–∞–ª–∏–∑, —Ä–∞–∑–≤–∏—Ç–∏–µ, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.\n"
        "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É—Å–∏–ª–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π.\n\n"
        "üíº <b>–ë–∏–∑–Ω–µ—Å</b>\n"
        "‚Ä¢ –ò–¥–µ–∏, —É–ø–∞–∫–æ–≤–∫–∞, —Ç–µ–∫—Å—Ç—ã, –≤–æ—Ä–æ–Ω–∫–∏, –≥–∏–ø–æ—Ç–µ–∑—ã, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞.\n\n"
        "üé® <b>–ö—Ä–µ–∞—Ç–∏–≤</b>\n"
        "‚Ä¢ –û–±—Ä–∞–∑—ã, –∫–æ–Ω—Ü–µ–ø—Ç—ã, —Å—Ç–æ—Ä–∏—Ç–µ–ª–ª–∏–Ω–≥, –∏–¥–µ–∏ –¥–ª—è –≤–∏–∑—É–∞–ª–∞ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.\n\n"
        "–ú–æ–∂–µ—à—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç —Å–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º ‚Äî —ç—Ç–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –º–µ–Ω—è–µ—Ç —Å—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–∞."
    )


# ---------- –ü–†–û–§–ò–õ–¨ ----------


def build_profile_text(
    first_name: Optional[str],
    username: Optional[str],
    current_mode: Optional[str],
    subscription_tier: Optional[str],
    subscription_expires_at: Optional[datetime],
    ref_link: str,
    referrals_count: int,
) -> str:
    name = first_name or "–ë–µ–∑ –∏–º–µ–Ω–∏"
    uname = f"@{username}" if username else "‚Äî"
    mode_text = _format_mode(current_mode)
    sub_text = _format_subscription(subscription_tier, subscription_expires_at)

    return (
        f"üë§ <b>–ü—Ä–æ—Ñ–∏–ª—å</b>\n\n"
        f"–ò–º—è: <b>{name}</b>\n"
        f"Username: <b>{uname}</b>\n"
        f"–†–µ–∂–∏–º: {mode_text}\n\n"
        f"{sub_text}\n\n"
        "üë• <b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</b>\n"
        f"–ü—Ä–∏–≤–ª–µ—á–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: <b>{referrals_count}</b>\n\n"
        "–¢–≤–æ—è –ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞:\n"
        f"<code>{ref_link}</code>\n\n"
        "–û—Ç–ø—Ä–∞–≤—å –µ—ë –¥—Ä—É–∑—å—è–º: –∑–∞ –∫–∞–∂–¥–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ ‚Äî –±–æ–Ω—É—Å–Ω—ã–µ –¥–Ω–∏ Premium."
    )


# ---------- –ü–û–î–ü–ò–°–ö–ê ----------


def build_subscription_text(
    subscription_tier: Optional[str],
    subscription_expires_at: Optional[datetime],
) -> str:
    sub_text = _format_subscription(subscription_tier, subscription_expires_at)
    return (
        "üíé <b>–ü–æ–¥–ø–∏—Å–∫–∞ BlackBox GPT</b>\n\n"
        f"{sub_text}\n\n"
        "–ü–ª–∞–Ω—ã:\n"
        "‚Ä¢ üíé 1 –º–µ—Å—è—Ü ‚Äî <b>$7.99</b>\n"
        "‚Ä¢ üíé 3 –º–µ—Å—è—Ü–∞ ‚Äî <b>$25.99</b>\n"
        "‚Ä¢ üíé 12 –º–µ—Å—è—Ü–µ–≤ ‚Äî <b>$89.99</b>\n\n"
        "–û–ø–ª–∞—Ç–∞ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ <b>Crypto Bot</b> (USDT –∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π asset).\n"
        "–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã Premium –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏."
    )


# ---------- –†–ï–§–ï–†–ê–õ–´ ----------


def build_referrals_text(ref_link: str, referrals_count: int) -> str:
    return (
        "üë• <b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</b>\n\n"
        "–î–µ–ª–∏—Å—å —Å–≤–æ–µ–π —Å—Å—ã–ª–∫–æ–π –∏ –ø–æ–ª—É—á–∞–π –±–æ–Ω—É—Å–Ω—ã–µ –¥–Ω–∏ Premium –∑–∞ –¥—Ä—É–∑–µ–π.\n\n"
        f"–ü—Ä–∏–≤–ª–µ—á–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: <b>{referrals_count}</b>\n\n"
        "–¢–≤–æ—è –ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞:\n"
        f"<code>{ref_link}</code>\n\n"
        "üîó –ö–Ω–æ–ø–∫–∞ –Ω–∏–∂–µ –æ—Ç–∫—Ä–æ–µ—Ç —Å—Å—ã–ª–∫—É —Å—Ä–∞–∑—É –≤ Telegram.\n"
        "–ß–µ–º –∞–∫—Ç–∏–≤–Ω–µ–µ —Ç–≤–æ—è —Å–µ—Ç—å ‚Äî —Ç–µ–º –¥–æ–ª—å—à–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç Premium."
    )
